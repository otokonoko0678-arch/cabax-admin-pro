<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabax Admin Pro - Complete Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @media (max-width: 768px) {
            .sidebar-mobile { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar-mobile.active { transform: translateX(0); }
        }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        .print-only { display: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; }
        .modal.active { display: flex; }
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 9999; animation: slideIn 0.3s; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; }
        .shift-badge { font-size: 0.6rem; padding: 1px 4px; border-radius: 2px; background: #8b5cf6; color: white; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="notificationArea"></div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 to-pink-900 p-4">
        <div class="w-full max-w-md p-8 bg-white rounded-xl shadow-2xl">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-gray-900">Cabax Admin Pro</h2>
                <p class="mt-2 text-sm text-gray-600">å®Œå…¨ç‰ˆ - Full Featured</p>
            </div>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <input type="text" id="shopCode" value="SHOP001" placeholder="åº—èˆ—ã‚³ãƒ¼ãƒ‰" class="w-full px-4 py-3 border rounded-lg">
                <input type="email" id="email" value="admin@example.com" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full px-4 py-3 border rounded-lg">
                <input type="password" id="password" value="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="w-full px-4 py-3 border rounded-lg">
                <button type="submit" class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg font-semibold">
                    ãƒ­ã‚°ã‚¤ãƒ³
                </button>
            </form>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div id="dashboardPage" class="hidden">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-gradient-to-b from-gray-900 to-gray-800 sidebar-mobile md:translate-x-0 no-print">
            <div class="flex h-full flex-col">
                <div class="flex h-16 items-center justify-between px-4 border-b border-gray-700">
                    <h1 class="text-xl font-bold text-white">Cabax Pro</h1>
                    <button onclick="toggleMobileSidebar()" class="md:hidden text-white">âœ•</button>
                </div>
                <div class="border-b border-gray-700 p-4">
                    <p class="text-xs text-gray-400">å–¶æ¥­æ—¥</p>
                    <p class="mt-1 text-lg font-semibold text-white" id="businessDate"></p>
                </div>
                <nav class="flex-1 overflow-y-auto px-2 py-4">
                    <button onclick="showTab('dashboard')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-white bg-gray-700 mb-1">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
                    <button onclick="showTab('tables')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">ğŸª‘ ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†</button>
                    <button onclick="showTab('attendance')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">â° å‹¤æ€ ç®¡ç†</button>
                    <button onclick="showTab('shifts')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">ğŸ“… ã‚·ãƒ•ãƒˆç®¡ç†</button>
                    <button onclick="showTab('orders')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">ğŸ“ æ³¨æ–‡ç®¡ç†</button>
                    <button onclick="showTab('menu')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</button>
                    <button onclick="showTab('casts')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">ğŸ‘¥ ã‚­ãƒ£ã‚¹ãƒˆç®¡ç†</button>
                    <button onclick="showTab('reports')" class="nav-btn w-full flex items-center rounded-lg px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 mb-1">ğŸ“ˆ å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</button>
                </nav>
                <div class="border-t border-gray-700 p-4">
                    <button onclick="logout()" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="md:pl-64 pt-4 pb-20 md:pb-4">
            <main class="p-4 md:p-6">
                
                <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
                <div id="dashboard-tab" class="tab-content active">
                    <div class="mb-6">
                        <h1 class="text-3xl font-bold text-gray-900">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                        <p class="text-gray-600 mt-1">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ APIé€£æºç‰ˆ</p>
                        <div class="mt-4 flex flex-wrap gap-2">
                            <button onclick="syncWithBackend()" class="bg-purple-600 text-white px-4 py-2 rounded-lg">
                                ğŸ”„ APIåŒæœŸ
                            </button>
                            <button onclick="printDailyReport()" class="bg-blue-600 text-white px-4 py-2 rounded-lg">
                                ğŸ–¨ï¸ æ—¥å ±å°åˆ·
                            </button>
                            <button onclick="exportCSV()" class="bg-green-600 text-white px-4 py-2 rounded-lg">
                                ğŸ“¥ CSVå‡ºåŠ›
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-sm text-purple-100">æœ¬æ—¥ã®å£²ä¸Š</p>
                            <p class="text-3xl font-bold mt-2" id="totalSales">Â¥0</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-sm text-blue-100">æ¥åº—çµ„æ•°</p>
                            <p class="text-3xl font-bold mt-2" id="totalCustomers">0çµ„</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-sm text-green-100">å‡ºå‹¤ä¸­</p>
                            <p class="text-3xl font-bold mt-2" id="workingCasts">0å</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white shadow-lg">
                            <p class="text-sm text-orange-100">å®¢å˜ä¾¡</p>
                            <p class="text-3xl font-bold mt-2" id="averageSpend">Â¥0</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">æ™‚é–“å¸¯åˆ¥å£²ä¸Š</h3>
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">æœ€è¿‘ã®æ´»å‹•</h3>
                            <div id="recentActivities" class="space-y-2"></div>
                        </div>
                    </div>
                </div>

                <!-- å‹¤æ€ ç®¡ç†ã‚¿ãƒ–ï¼ˆæ–°æ©Ÿèƒ½ï¼‰ -->
                <div id="attendance-tab" class="tab-content">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">â° å‹¤æ€ ç®¡ç†</h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- å‡ºé€€å‹¤æ‰“åˆ» -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold mb-4">ğŸ“ æ‰“åˆ»</h3>
                            <select id="attendanceCast" class="w-full border rounded-lg px-4 py-2 mb-4">
                                <option value="">ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠ</option>
                            </select>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="clockIn()" class="bg-green-600 text-white py-3 rounded-lg font-semibold">
                                    âœ… å‡ºå‹¤
                                </button>
                                <button onclick="clockOut()" class="bg-red-600 text-white py-3 rounded-lg font-semibold">
                                    âŒ é€€å‹¤
                                </button>
                            </div>
                        </div>

                        <!-- æœ¬æ—¥ã®å‹¤æ€ çŠ¶æ³ -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold mb-4">ğŸ‘¥ æœ¬æ—¥ã®å‡ºå‹¤è€…</h3>
                            <div id="todayAttendance" class="space-y-2"></div>
                        </div>
                    </div>

                    <!-- å‹¤æ€ å±¥æ­´ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">ğŸ“‹ å‹¤æ€ å±¥æ­´</h3>
                            <button onclick="exportAttendanceCSV()" class="bg-blue-600 text-white px-4 py-2 rounded-lg">
                                CSVå‡ºåŠ›
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="text-left py-3 px-4">æ—¥ä»˜</th>
                                        <th class="text-left py-3 px-4">ã‚­ãƒ£ã‚¹ãƒˆ</th>
                                        <th class="text-center py-3 px-4">å‡ºå‹¤</th>
                                        <th class="text-center py-3 px-4">é€€å‹¤</th>
                                        <th class="text-center py-3 px-4">åŠ´åƒæ™‚é–“</th>
                                        <th class="text-center py-3 px-4">çŠ¶æ…‹</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç† -->
                <div id="tables-tab" class="tab-content">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">ğŸª‘ ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†</h1>
                    <div id="tablesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
                </div>

                <!-- ã‚·ãƒ•ãƒˆç®¡ç† -->
                <div id="shifts-tab" class="tab-content">
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">ğŸ“… ã‚·ãƒ•ãƒˆç®¡ç†</h1>
                    <div class="mb-4 flex gap-2">
                        <button onclick="openAddShiftModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg">
                            â• ã‚·ãƒ•ãƒˆè¿½åŠ 
                        </button>
                        <button onclick="printShiftTable()" class="bg-blue-600 text-white px-4 py-2 rounded-lg">
                            ğŸ–¨ï¸ å°åˆ·
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <button onclick="previousMonth()" class="px-4 py-2 bg-gray-200 rounded">â†</button>
                            <h3 class="text-xl font-bold" id="currentMonth">2024å¹´11æœˆ</h3>
                            <button onclick="nextMonth()" class="px-4 py-2 bg-gray-200 rounded">â†’</button>
                        </div>
                        <div class="calendar-grid text-sm" id="shiftCalendar"></div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">ä»Šé€±ã®ã‚·ãƒ•ãƒˆ</h3>
                        <div id="weeklyShifts" class="space-y-3"></div>
                    </div>
                </div>

                <!-- æ³¨æ–‡ç®¡ç† -->
                <div id="orders-tab" class="tab-content">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">ğŸ“ æ³¨æ–‡ç®¡ç†</h1>
                    <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left py-3 px-4">ãƒ†ãƒ¼ãƒ–ãƒ«</th>
                                    <th class="text-left py-3 px-4">å•†å“</th>
                                    <th class="text-center py-3 px-4">æ•°é‡</th>
                                    <th class="text-right py-3 px-4">é‡‘é¡</th>
                                    <th class="text-center py-3 px-4">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† -->
                <div id="menu-tab" class="tab-content">
                    <div class="mb-6 flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-gray-900">ğŸ½ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</h1>
                        <button onclick="openAddMenuModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg">
                            â• ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
                        </button>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left py-3 px-4">å•†å“å</th>
                                    <th class="text-left py-3 px-4">ã‚«ãƒ†ã‚´ãƒª</th>
                                    <th class="text-right py-3 px-4">ä¾¡æ ¼</th>
                                    <th class="text-center py-3 px-4">åœ¨åº«</th>
                                    <th class="text-center py-3 px-4">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="menuTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- ã‚­ãƒ£ã‚¹ãƒˆç®¡ç† -->
                <div id="casts-tab" class="tab-content">
                    <div class="mb-6 flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-gray-900">ğŸ‘¥ ã‚­ãƒ£ã‚¹ãƒˆç®¡ç†</h1>
                        <button onclick="openAddCastModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg">
                            â• ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ 
                        </button>
                    </div>
                    <div id="castsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ -->
                <div id="reports-tab" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-3xl font-bold text-gray-900">ğŸ“ˆ å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</h1>
                        <div class="mt-4 flex flex-wrap gap-2">
                            <button onclick="generateReport('daily')" class="bg-purple-600 text-white px-4 py-2 rounded-lg">æ—¥æ¬¡</button>
                            <button onclick="generateReport('weekly')" class="bg-blue-600 text-white px-4 py-2 rounded-lg">é€±æ¬¡</button>
                            <button onclick="generateReport('monthly')" class="bg-green-600 text-white px-4 py-2 rounded-lg">æœˆæ¬¡</button>
                            <button onclick="exportFullReport()" class="bg-orange-600 text-white px-4 py-2 rounded-lg">ãƒ•ãƒ«å‡ºåŠ›</button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">æ—¥åˆ¥å£²ä¸Šæ¨ç§»</h3>
                            <canvas id="dailySalesChart"></canvas>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold mb-4">ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Š</h3>
                            <canvas id="categorySalesChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold mb-4">å£²ä¸Šæ˜ç´°</h3>
                        <div id="salesDetails" class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="text-left py-2 px-4">æ—¥ä»˜</th>
                                        <th class="text-left py-2 px-4">ãƒ†ãƒ¼ãƒ–ãƒ«</th>
                                        <th class="text-center py-2 px-4">äººæ•°</th>
                                        <th class="text-right py-2 px-4">å£²ä¸Š</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ  -->
    <div id="addCastModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl">
            <div class="border-b px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold">ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ </h2>
                <button onclick="closeModal('addCastModal')" class="text-gray-400">âœ•</button>
            </div>
            <div class="p-6">
                <form onsubmit="addCast(event)">
                    <div class="space-y-4">
                        <input type="text" id="castName" placeholder="åå‰" class="w-full px-3 py-2 border rounded-lg" required>
                        <select id="castRank" class="w-full px-3 py-2 border rounded-lg">
                            <option value="regular">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</option>
                            <option value="chief">ãƒãƒ¼ãƒ•</option>
                            <option value="manager">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</option>
                        </select>
                        <input type="number" id="castHourlyRate" placeholder="æ™‚çµ¦" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div class="mt-6 flex gap-2">
                        <button type="submit" class="flex-1 bg-purple-600 text-white py-2 rounded-lg">è¿½åŠ </button>
                        <button type="button" onclick="closeModal('addCastModal')" class="flex-1 border py-2 rounded-lg">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚­ãƒ£ã‚¹ãƒˆç·¨é›†ï¼ˆæ–°æ©Ÿèƒ½ï¼‰ -->
    <div id="editCastModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl">
            <div class="border-b px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold">ã‚­ãƒ£ã‚¹ãƒˆç·¨é›†</h2>
                <button onclick="closeModal('editCastModal')" class="text-gray-400">âœ•</button>
            </div>
            <div class="p-6">
                <form onsubmit="updateCast(event)">
                    <input type="hidden" id="editCastId">
                    <div class="space-y-4">
                        <input type="text" id="editCastName" placeholder="åå‰" class="w-full px-3 py-2 border rounded-lg" required>
                        <select id="editCastRank" class="w-full px-3 py-2 border rounded-lg">
                            <option value="regular">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</option>
                            <option value="chief">ãƒãƒ¼ãƒ•</option>
                            <option value="manager">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</option>
                        </select>
                        <input type="number" id="editCastHourlyRate" placeholder="æ™‚çµ¦" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div class="mt-6 flex gap-2">
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg">æ›´æ–°</button>
                        <button type="button" onclick="closeModal('editCastModal')" class="flex-1 border py-2 rounded-lg">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ  -->
    <div id="addMenuModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl">
            <div class="border-b px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold">ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ </h2>
                <button onclick="closeModal('addMenuModal')" class="text-gray-400">âœ•</button>
            </div>
            <div class="p-6">
                <form onsubmit="addMenuItem(event)">
                    <div class="space-y-4">
                        <input type="text" id="menuName" placeholder="å•†å“å" class="w-full px-3 py-2 border rounded-lg" required>
                        <select id="menuCategory" class="w-full px-3 py-2 border rounded-lg">
                            <option value="bottle">ãƒœãƒˆãƒ«</option>
                            <option value="drink">ãƒ‰ãƒªãƒ³ã‚¯</option>
                            <option value="food">ãƒ•ãƒ¼ãƒ‰</option>
                            <option value="set">ã‚»ãƒƒãƒˆ</option>
                        </select>
                        <input type="number" id="menuPrice" placeholder="ä¾¡æ ¼" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div class="mt-6 flex gap-2">
                        <button type="submit" class="flex-1 bg-purple-600 text-white py-2 rounded-lg">è¿½åŠ </button>
                        <button type="button" onclick="closeModal('addMenuModal')" class="flex-1 border py-2 rounded-lg">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚·ãƒ•ãƒˆè¿½åŠ  -->
    <div id="addShiftModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl">
            <div class="border-b px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold">ã‚·ãƒ•ãƒˆç™»éŒ²</h2>
                <button onclick="closeModal('addShiftModal')" class="text-gray-400">âœ•</button>
            </div>
            <div class="p-6">
                <form onsubmit="saveShift(event)">
                    <div class="space-y-4">
                        <select id="shiftCast" class="w-full px-3 py-2 border rounded-lg" required>
                            <option value="">ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠ</option>
                        </select>
                        <input type="date" id="shiftDate" class="w-full px-3 py-2 border rounded-lg" required>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="time" id="shiftStart" value="20:00" class="w-full px-3 py-2 border rounded-lg">
                            <input type="time" id="shiftEnd" value="01:00" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                    </div>
                    <div class="mt-6 flex gap-2">
                        <button type="submit" class="flex-1 bg-purple-600 text-white py-2 rounded-lg">ç™»éŒ²</button>
                        <button type="button" onclick="closeModal('addShiftModal')" class="flex-1 border py-2 rounded-lg">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // APIè¨­å®š
        const API_BASE = 'http://localhost:8000/api/v1';
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        const appState = {
            currentUser: null,
            currentMonth: new Date(),
            tables: [],
            sessions: [],
            menuItems: [],
            casts: [],
            orders: [],
            shifts: [],
            attendances: [],
            sales: 0,
            apiConnected: false
        };

        // åˆæœŸåŒ–
        function initializeApp() {
            setupBusinessDate();
            loadDemoData();
            syncWithBackend();
            setupCharts();
            updateDashboard();
            initializeShiftCalendar();
            renderAttendance();
            populateCastSelects();
        }

        function setupBusinessDate() {
            const today = new Date();
            document.getElementById('businessDate').textContent = 
                today.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        }

        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadDemoData() {
            appState.tables = [
                { id: 1, name: 'A1', status: 'available' },
                { id: 2, name: 'A2', status: 'occupied', sessionId: 1 },
                { id: 3, name: 'VIP1', status: 'occupied', isVip: true, sessionId: 2 },
                { id: 4, name: 'B1', status: 'available' },
                { id: 5, name: 'B2', status: 'reserved' }
            ];

            appState.menuItems = [
                { id: 1, name: 'ãƒ‰ãƒ³ãƒšãƒªãƒ‹ãƒ¨ãƒ³', category: 'bottle', price: 150000, stock: 5 },
                { id: 2, name: 'ãƒã‚¤ãƒœãƒ¼ãƒ«', category: 'drink', price: 800, stock: 100 },
                { id: 3, name: '90åˆ†ã‚»ãƒƒãƒˆ', category: 'set', price: 5000, stock: null }
            ];

            appState.casts = [
                { id: 1, name: 'ã•ãã‚‰', rank: 'chief', hourlyRate: 3500, sales: 285000 },
                { id: 2, name: 'ã‚†ã', rank: 'regular', hourlyRate: 2500, sales: 168000 }
            ];

            appState.sessions = [
                { id: 1, tableId: 2, startTime: '21:30', guests: 4, total: 26400 },
                { id: 2, tableId: 3, startTime: '20:00', guests: 6, total: 160000 }
            ];

            appState.attendances = [
                { id: 1, castId: 1, date: new Date().toISOString().split('T')[0], clockIn: '20:00', clockOut: null, status: 'working' }
            ];

            renderTables();
            renderMenu();
            renderCasts();
            renderOrders();
            renderReports();
        }

        // APIåŒæœŸ
        async function syncWithBackend() {
            try {
                showNotification('APIã¨åŒæœŸä¸­...', 'info');
                
                const [tables, menu, casts] = await Promise.all([
                    fetch(`${API_BASE}/tables`).then(r => r.ok ? r.json() : []),
                    fetch(`${API_BASE}/menu`).then(r => r.ok ? r.json() : []),
                    fetch(`${API_BASE}/casts`).then(r => r.ok ? r.json() : [])
                ]);

                if (tables.length) appState.tables = tables;
                if (menu.length) appState.menuItems = menu;
                if (casts.length) appState.casts = casts;

                appState.apiConnected = true;
                showNotification('APIåŒæœŸå®Œäº†ï¼', 'success');
                
                renderTables();
                renderMenu();
                renderCasts();
            } catch (error) {
                console.error('APIåŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                showNotification('APIã‚ªãƒ•ãƒ©ã‚¤ãƒ³ - ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­', 'warning');
                appState.apiConnected = false;
            }
        }

        // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        function handleLogin(event) {
            event.preventDefault();
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            initializeApp();
            showNotification('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ', 'success');
        }

        function logout() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            showNotification('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'info');
        }

        // ã‚¿ãƒ–åˆ‡æ›¿
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-gray-700', 'text-white');
                btn.classList.add('text-gray-300');
            });
            event.target.classList.add('bg-gray-700', 'text-white');
            event.target.classList.remove('text-gray-300');
        }

        // å‹¤æ€ ç®¡ç†æ©Ÿèƒ½
        function populateCastSelects() {
            const select = document.getElementById('attendanceCast');
            const shiftSelect = document.getElementById('shiftCast');
            
            const options = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
                appState.casts.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            if (select) select.innerHTML = options;
            if (shiftSelect) shiftSelect.innerHTML = options;
        }

        function clockIn() {
            const castId = parseInt(document.getElementById('attendanceCast').value);
            if (!castId) {
                showNotification('ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const now = new Date();
            const attendance = {
                id: appState.attendances.length + 1,
                castId: castId,
                date: now.toISOString().split('T')[0],
                clockIn: now.toTimeString().split(' ')[0],
                clockOut: null,
                status: 'working'
            };

            appState.attendances.push(attendance);
            showNotification('å‡ºå‹¤æ‰“åˆ»ã—ã¾ã—ãŸ', 'success');
            renderAttendance();
        }

        function clockOut() {
            const castId = parseInt(document.getElementById('attendanceCast').value);
            if (!castId) {
                showNotification('ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const attendance = appState.attendances.find(a => 
                a.castId === castId && 
                a.date === new Date().toISOString().split('T')[0] && 
                a.status === 'working'
            );

            if (!attendance) {
                showNotification('å‡ºå‹¤è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }

            attendance.clockOut = new Date().toTimeString().split(' ')[0];
            attendance.status = 'completed';
            
            showNotification('é€€å‹¤æ‰“åˆ»ã—ã¾ã—ãŸ', 'success');
            renderAttendance();
        }

        function renderAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendances = appState.attendances.filter(a => a.date === today && a.status === 'working');
            
            const todayDiv = document.getElementById('todayAttendance');
            if (todayDiv) {
                todayDiv.innerHTML = todayAttendances.length === 0 
                    ? '<p class="text-gray-500">å‡ºå‹¤è€…ãªã—</p>'
                    : todayAttendances.map(a => {
                        const cast = appState.casts.find(c => c.id === a.castId);
                        return `
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                <span class="font-semibold">${cast?.name || ''}</span>
                                <span class="text-sm text-gray-600">å‡ºå‹¤: ${a.clockIn}</span>
                            </div>
                        `;
                    }).join('');
            }

            const tbody = document.getElementById('attendanceTableBody');
            if (tbody) {
                tbody.innerHTML = appState.attendances.map(a => {
                    const cast = appState.casts.find(c => c.id === a.castId);
                    const hours = a.clockOut ? calculateHours(a.clockIn, a.clockOut) : '-';
                    const status = a.status === 'working' ? 'å‹¤å‹™ä¸­' : 'é€€å‹¤æ¸ˆ';
                    const statusColor = a.status === 'working' ? 'text-green-600' : 'text-gray-600';
                    
                    return `
                        <tr class="border-b">
                            <td class="py-3 px-4">${a.date}</td>
                            <td class="py-3 px-4">${cast?.name || ''}</td>
                            <td class="py-3 px-4 text-center">${a.clockIn}</td>
                            <td class="py-3 px-4 text-center">${a.clockOut || '-'}</td>
                            <td class="py-3 px-4 text-center">${hours}</td>
                            <td class="py-3 px-4 text-center ${statusColor}">${status}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function calculateHours(clockIn, clockOut) {
            const [h1, m1] = clockIn.split(':').map(Number);
            const [h2, m2] = clockOut.split(':').map(Number);
            const minutes = (h2 * 60 + m2) - (h1 * 60 + m1);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours}æ™‚é–“${mins}åˆ†`;
        }

        function exportAttendanceCSV() {
            const csv = 'æ—¥ä»˜,ã‚­ãƒ£ã‚¹ãƒˆ,å‡ºå‹¤,é€€å‹¤,åŠ´åƒæ™‚é–“,çŠ¶æ…‹\n' + 
                appState.attendances.map(a => {
                    const cast = appState.casts.find(c => c.id === a.castId);
                    const hours = a.clockOut ? calculateHours(a.clockIn, a.clockOut) : '-';
                    return `${a.date},${cast?.name},${a.clockIn},${a.clockOut || ''},${hours},${a.status}`;
                }).join('\n');
            
            downloadCSV(csv, 'attendance.csv');
            showNotification('å‹¤æ€ CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
        }

        // ã‚­ãƒ£ã‚¹ãƒˆç·¨é›†æ©Ÿèƒ½
        function editCast(id) {
            const cast = appState.casts.find(c => c.id === id);
            if (!cast) return;
            
            document.getElementById('editCastId').value = cast.id;
            document.getElementById('editCastName').value = cast.name;
            document.getElementById('editCastRank').value = cast.rank;
            document.getElementById('editCastHourlyRate').value = cast.hourlyRate;
            
            document.getElementById('editCastModal').classList.add('active');
        }

        async function updateCast(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editCastId').value);
            const cast = appState.casts.find(c => c.id === id);
            
            if (cast) {
                cast.name = document.getElementById('editCastName').value;
                cast.rank = document.getElementById('editCastRank').value;
                cast.hourlyRate = parseInt(document.getElementById('editCastHourlyRate').value);
                
                if (appState.apiConnected) {
                    try {
                        await fetch(`${API_BASE}/casts/${id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(cast)
                        });
                    } catch (error) {
                        console.error('APIæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                    }
                }
                
                renderCasts();
                populateCastSelects();
                closeModal('editCastModal');
                showNotification('ã‚­ãƒ£ã‚¹ãƒˆæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
            }
        }

        // ã‚·ãƒ•ãƒˆç®¡ç†æ©Ÿèƒ½
        function initializeShiftCalendar() {
            renderShiftCalendar();
            renderWeeklyShifts();
        }

        function renderShiftCalendar() {
            const calendar = document.getElementById('shiftCalendar');
            if (!calendar) return;

            const year = appState.currentMonth.getFullYear();
            const month = appState.currentMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            document.getElementById('currentMonth').textContent = `${year}å¹´${month + 1}æœˆ`;

            let html = '';
            const weekDays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            weekDays.forEach(day => {
                html += `<div class="text-center font-bold p-2 bg-gray-100">${day}</div>`;
            });

            for (let i = 0; i < firstDay; i++) {
                html += `<div class="p-2 bg-gray-50"></div>`;
            }

            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const shiftsForDate = appState.shifts.filter(s => s.date === dateStr);
                
                html += `<div class="border p-2 min-h-[80px] bg-white hover:bg-gray-50">
                    <div class="font-semibold text-sm mb-1">${date}</div>
                    <div class="space-y-1">
                        ${shiftsForDate.map(shift => {
                            const cast = appState.casts.find(c => c.id === shift.castId);
                            return `<div class="shift-badge">${cast?.name || ''}</div>`;
                        }).join('')}
                    </div>
                </div>`;
            }

            calendar.innerHTML = html;
        }

        function renderWeeklyShifts() {
            const container = document.getElementById('weeklyShifts');
            if (!container) return;

            const today = new Date();
            const weekShifts = appState.shifts.filter(s => {
                const shiftDate = new Date(s.date);
                const diff = Math.floor((shiftDate - today) / (1000 * 60 * 60 * 24));
                return diff >= 0 && diff < 7;
            });

            container.innerHTML = weekShifts.length === 0 
                ? '<p class="text-gray-500">ä»Šé€±ã®ã‚·ãƒ•ãƒˆãªã—</p>'
                : weekShifts.map(shift => {
                    const cast = appState.casts.find(c => c.id === shift.castId);
                    return `
                        <div class="bg-gray-50 rounded-lg p-4 flex justify-between items-center">
                            <div>
                                <p class="font-bold">${cast?.name || ''}</p>
                                <p class="text-sm text-gray-600">${shift.date}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm">${shift.start} - ${shift.end}</p>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function openAddShiftModal() {
            populateCastSelects();
            document.getElementById('addShiftModal').classList.add('active');
        }

        async function saveShift(event) {
            event.preventDefault();
            
            const shift = {
                id: appState.shifts.length + 1,
                castId: parseInt(document.getElementById('shiftCast').value),
                date: document.getElementById('shiftDate').value,
                start: document.getElementById('shiftStart').value,
                end: document.getElementById('shiftEnd').value
            };

            appState.shifts.push(shift);
            
            if (appState.apiConnected) {
                try {
                    await fetch(`${API_BASE}/shifts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(shift)
                    });
                } catch (error) {
                    console.error('ã‚·ãƒ•ãƒˆç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            renderShiftCalendar();
            renderWeeklyShifts();
            closeModal('addShiftModal');
            showNotification('ã‚·ãƒ•ãƒˆã‚’ç™»éŒ²ã—ã¾ã—ãŸ', 'success');
        }

        function previousMonth() {
            appState.currentMonth.setMonth(appState.currentMonth.getMonth() - 1);
            renderShiftCalendar();
        }

        function nextMonth() {
            appState.currentMonth.setMonth(appState.currentMonth.getMonth() + 1);
            renderShiftCalendar();
        }

        // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
        function renderTables() {
            const grid = document.getElementById('tablesGrid');
            if (!grid) return;
            
            grid.innerHTML = appState.tables.map(table => {
                const statusColor = table.status === 'available' ? 'green' : 
                                  table.status === 'occupied' ? 'red' : 'yellow';
                const statusText = table.status === 'available' ? 'ç©ºå¸­' : 
                                 table.status === 'occupied' ? 'ä½¿ç”¨ä¸­' : 'äºˆç´„';
                
                return `
                    <div class="bg-${statusColor}-100 border-2 border-${statusColor}-500 rounded-lg p-4 cursor-pointer hover:shadow-lg transition">
                        ${table.isVip ? '<span class="text-xs bg-yellow-400 px-2 py-1 rounded">VIP</span>' : ''}
                        <div class="text-center mt-2">
                            <p class="text-2xl font-bold">${table.name}</p>
                            <p class="text-sm">${statusText}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
        function renderMenu() {
            const tbody = document.getElementById('menuTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = appState.menuItems.map(item => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4">${item.name}</td>
                    <td class="py-3 px-4">
                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">
                            ${getCategoryLabel(item.category)}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-right">Â¥${item.price.toLocaleString()}</td>
                    <td class="py-3 px-4 text-center">${item.stock || '-'}</td>
                    <td class="py-3 px-4 text-center">
                        <button onclick="deleteMenuItem(${item.id})" class="text-red-600 hover:text-red-800">å‰Šé™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        function getCategoryLabel(category) {
            const labels = { bottle: 'ãƒœãƒˆãƒ«', drink: 'ãƒ‰ãƒªãƒ³ã‚¯', food: 'ãƒ•ãƒ¼ãƒ‰', set: 'ã‚»ãƒƒãƒˆ' };
            return labels[category] || category;
        }

        function openAddMenuModal() {
            document.getElementById('addMenuModal').classList.add('active');
        }

        async function addMenuItem(event) {
            event.preventDefault();
            
            const newItem = {
                id: appState.menuItems.length + 1,
                name: document.getElementById('menuName').value,
                category: document.getElementById('menuCategory').value,
                price: parseInt(document.getElementById('menuPrice').value),
                stock: 10
            };

            appState.menuItems.push(newItem);
            
            if (appState.apiConnected) {
                try {
                    await fetch(`${API_BASE}/menu`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newItem)
                    });
                } catch (error) {
                    console.error('ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            renderMenu();
            closeModal('addMenuModal');
            showNotification('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
        }

        function deleteMenuItem(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                appState.menuItems = appState.menuItems.filter(item => item.id !== id);
                renderMenu();
                showNotification('å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
            }
        }

        // ã‚­ãƒ£ã‚¹ãƒˆè¡¨ç¤º
        function renderCasts() {
            const grid = document.getElementById('castsGrid');
            if (!grid) return;
            
            grid.innerHTML = appState.casts.map(cast => `
                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                    <div class="mb-4">
                        <h3 class="font-bold text-xl">${cast.name}</h3>
                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">
                            ${getRankLabel(cast.rank)}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>æ™‚çµ¦</span>
                            <span>Â¥${cast.hourlyRate.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>æœ¬æ—¥å£²ä¸Š</span>
                            <span>Â¥${cast.sales.toLocaleString()}</span>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button onclick="editCast(${cast.id})" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                            ç·¨é›†
                        </button>
                        <button onclick="deleteCast(${cast.id})" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                            å‰Šé™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getRankLabel(rank) {
            const labels = { regular: 'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼', chief: 'ãƒãƒ¼ãƒ•', manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' };
            return labels[rank] || rank;
        }

        function openAddCastModal() {
            document.getElementById('addCastModal').classList.add('active');
        }

        async function addCast(event) {
            event.preventDefault();
            
            const newCast = {
                id: appState.casts.length + 1,
                name: document.getElementById('castName').value,
                rank: document.getElementById('castRank').value,
                hourlyRate: parseInt(document.getElementById('castHourlyRate').value),
                sales: 0
            };

            appState.casts.push(newCast);
            
            if (appState.apiConnected) {
                try {
                    await fetch(`${API_BASE}/casts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newCast)
                    });
                } catch (error) {
                    console.error('ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            renderCasts();
            populateCastSelects();
            closeModal('addCastModal');
            showNotification('ã‚­ãƒ£ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
        }

        function deleteCast(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                appState.casts = appState.casts.filter(cast => cast.id !== id);
                renderCasts();
                populateCastSelects();
                showNotification('å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
            }
        }

        // æ³¨æ–‡è¡¨ç¤º
        function renderOrders() {
            const tbody = document.getElementById('ordersTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>';
        }

        // ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
        function renderReports() {
            const tbody = document.getElementById('reportTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = appState.sessions.map(session => {
                const table = appState.tables.find(t => t.id === session.tableId);
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-2 px-4">${new Date().toLocaleDateString()}</td>
                        <td class="py-2 px-4">${table?.name || '-'}</td>
                        <td class="py-2 px-4 text-center">${session.guests}</td>
                        <td class="py-2 px-4 text-right">Â¥${session.total.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');
        }

        function generateReport(type) {
            showNotification(`${type}ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...`, 'info');
            setTimeout(() => {
                showNotification(`${type}ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ`, 'success');
            }, 1000);
        }

        function exportFullReport() {
            showNotification('ãƒ•ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›ä¸­...', 'info');
            setTimeout(() => {
                showNotification('ãƒ•ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
            }, 1500);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateDashboard() {
            const totalSales = appState.sessions.reduce((sum, s) => sum + s.total, 0);
            const workingCount = appState.attendances.filter(a => a.status === 'working').length;
            
            document.getElementById('totalSales').textContent = `Â¥${totalSales.toLocaleString()}`;
            document.getElementById('totalCustomers').textContent = appState.sessions.length + 'çµ„';
            document.getElementById('workingCasts').textContent = workingCount + 'å';
            
            const avg = totalSales / (appState.sessions.length || 1);
            document.getElementById('averageSpend').textContent = `Â¥${Math.round(avg).toLocaleString()}`;

            const activities = document.getElementById('recentActivities');
            if (activities) {
                activities.innerHTML = `
                    <div class="flex justify-between py-2 border-b">
                        <span class="text-sm">22:30</span>
                        <span class="text-sm">ãƒ†ãƒ¼ãƒ–ãƒ«A2ã‚’é–‹ãã¾ã—ãŸ</span>
                    </div>
                    <div class="flex justify-between py-2 border-b">
                        <span class="text-sm">22:15</span>
                        <span class="text-sm">VIP1ã«æ³¨æ–‡è¿½åŠ </span>
                    </div>
                `;
            }
        }

        // ã‚°ãƒ©ãƒ•è¨­å®š
        function setupCharts() {
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                new Chart(salesCtx, {
                    type: 'bar',
                    data: {
                        labels: ['19æ™‚', '20æ™‚', '21æ™‚', '22æ™‚', '23æ™‚', '24æ™‚'],
                        datasets: [{
                            label: 'å£²ä¸Š',
                            data: [120000, 180000, 320000, 280000, 150000, 80000],
                            backgroundColor: 'rgba(147, 51, 234, 0.7)'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: true }
                });
            }

            const dailyCtx = document.getElementById('dailySalesChart');
            if (dailyCtx) {
                new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'],
                        datasets: [{
                            label: 'å£²ä¸Š',
                            data: [980000, 1120000, 890000, 1340000, 1560000, 1890000, 1650000],
                            borderColor: 'rgb(147, 51, 234)',
                            tension: 0.1,
                            fill: false
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: true }
                });
            }

            const categoryCtx = document.getElementById('categorySalesChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ãƒœãƒˆãƒ«', 'ãƒ‰ãƒªãƒ³ã‚¯', 'ãƒ•ãƒ¼ãƒ‰', 'ã‚»ãƒƒãƒˆ'],
                        datasets: [{
                            data: [450000, 120000, 80000, 150000],
                            backgroundColor: [
                                'rgba(147, 51, 234, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(251, 146, 60, 0.8)'
                            ]
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: true }
                });
            }
        }

        // å°åˆ·ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function printDailyReport() {
            window.print();
            showNotification('æ—¥å ±ã‚’å°åˆ·ã—ã¾ã™', 'info');
        }

        function printShiftTable() {
            window.print();
            showNotification('ã‚·ãƒ•ãƒˆè¡¨ã‚’å°åˆ·ã—ã¾ã™', 'info');
        }

        function exportCSV() {
            const csv = 'ãƒ†ãƒ¼ãƒ–ãƒ«,æ™‚é–“,äººæ•°,å£²ä¸Š\n' + 
                appState.sessions.map(s => {
                    const table = appState.tables.find(t => t.id === s.tableId);
                    return `${table?.name},${s.startTime},${s.guests},${s.total}`;
                }).join('\n');
            
            downloadCSV(csv, 'sales.csv');
            showNotification('CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function toggleMobileSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg`;
            notification.textContent = message;
            
            document.getElementById('notificationArea').appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>